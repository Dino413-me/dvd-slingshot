<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>DVD Bounce Launcher â€” Slingshot Edition</title>

<style>
    body {
        margin: 0;
        overflow: hidden;
        background: #000;
        font-family: Arial, sans-serif;
        color: white;
    }

    #ui {
        position: fixed;
        top: 10px;
        left: 10px;
        z-index: 20;
        background: rgba(0,0,0,0.4);
        padding: 8px 12px;
        border-radius: 6px;
        display: flex;
        gap: 20px;
        align-items: center;
    }

    select {
        font-size: 16px;
        padding: 4px 8px;
    }

    #dvd {
        width: 100px;
        height: 50px;
        background: #ff0000;
        position: absolute;
        border-radius: 8px;
        user-select: none;
    }

    .trail {
        position: absolute;
        width: 100px;
        height: 50px;
        border-radius: 8px;
        pointer-events: none;
        opacity: 0.4;
    }

    #aimLine {
        position: absolute;
        pointer-events: none;
        z-index: 5;
    }

    #flash {
        position: fixed;
        inset: 0;
        background: white;
        opacity: 0;
        pointer-events: none;
        z-index: 50;
    }

    #effects {
        position: fixed;
        inset: 0;
        pointer-events: none;
        z-index: 40;
        overflow: visible;
    }
</style>
</head>

<body>

<div id="ui">
    <div>Bounces: <span id="bounceCount">0</span></div>

    <label>Speed:
        <select id="speedSelect">
            <option value="0.25">0.25x</option>
            <option value="0.5">0.5x</option>
            <option value="1" selected>1x</option>
            <option value="1.5">1.5x</option>
            <option value="2">2x</option>
            <option value="5">5x</option>
            <option value="instant">Instant</option>
        </select>
    </label>
</div>

<canvas id="aimLine"></canvas>
<div id="effects"></div>
<div id="flash"></div>

<div id="dvd"></div>

<script>
const dvd = document.getElementById("dvd");
const bounceCountEl = document.getElementById("bounceCount");
const speedSelect = document.getElementById("speedSelect");
const aimCanvas = document.getElementById("aimLine");
const ctx = aimCanvas.getContext("2d");
const effects = document.getElementById("effects");
const flash = document.getElementById("flash");

let dragging = false;
let offsetX = 0, offsetY = 0;

// base velocity (never multiplied)
let baseVX = 0;
let baseVY = 0;

// actual velocity (computed each frame)
let vx = 0;
let vy = 0;

let bounceCount = 0;
let animating = false;
let speedMultiplier = 1;

// Resize aiming canvas
function resizeCanvas() {
    aimCanvas.width = window.innerWidth;
    aimCanvas.height = window.innerHeight;
}
resizeCanvas();
window.addEventListener("resize", resizeCanvas);

// Center DVD
function centerDVD() {
    dvd.style.left = (window.innerWidth / 2 - dvd.clientWidth / 2) + "px";
    dvd.style.top = (window.innerHeight / 2 - dvd.clientHeight / 2) + "px";
}
centerDVD();

// Color cycle
let hue = 0;
function updateColor() {
    hue = (hue + 1) % 360;
    dvd.style.background = `hsl(${hue}, 100%, 50%)`;
}
setInterval(updateColor, 40);

// Speed change
speedSelect.addEventListener("change", () => {
    const val = speedSelect.value;

    if (val === "instant") {
        animating = false;
        runInstant();
        return;
    }

    speedMultiplier = parseFloat(val);
});

// Draw dotted aiming line
function drawAimLine(x1, y1, x2, y2) {
    ctx.clearRect(0, 0, aimCanvas.width, aimCanvas.height);
    ctx.setLineDash([4, 6]);
    ctx.strokeStyle = "white";
    ctx.lineWidth = 2;

    ctx.beginPath();
    ctx.moveTo(x1, y1);
    ctx.lineTo(x2, y2);
    ctx.stroke();
}

// Dragging
dvd.addEventListener("mousedown", e => {
    dragging = true;
    animating = false;
    baseVX = baseVY = 0;
    bounceCount = 0;
    bounceCountEl.textContent = 0;

    offsetX = e.clientX - dvd.offsetLeft;
    offsetY = e.clientY - dvd.offsetTop;
});

document.addEventListener("mousemove", e => {
    if (!dragging) return;

    dvd.style.left = (e.clientX - offsetX) + "px";
    dvd.style.top = (e.clientY - offsetY) + "px";

    drawAimLine(
        window.innerWidth / 2,
        window.innerHeight / 2,
        dvd.offsetLeft + dvd.clientWidth / 2,
        dvd.offsetTop + dvd.clientHeight / 2
    );
});

document.addEventListener("mouseup", e => {
    if (!dragging) return;
    dragging = false;

    ctx.clearRect(0, 0, aimCanvas.width, aimCanvas.height);

    // True slingshot: shoot toward center
    baseVX = (window.innerWidth / 2 - (dvd.offsetLeft + dvd.clientWidth / 2)) * 0.15;
    baseVY = (window.innerHeight / 2 - (dvd.offsetTop + dvd.clientHeight / 2)) * 0.15;

    if (speedSelect.value === "instant") {
        runInstant();
    } else {
        animating = true;
        requestAnimationFrame(update);
    }
});

// Ghost trail
function spawnTrail() {
    const t = document.createElement("div");
    t.className = "trail";
    t.style.left = dvd.style.left;
    t.style.top = dvd.style.top;
    t.style.background = dvd.style.background;
    t.style.opacity = "0.4";
    document.body.appendChild(t);

    setTimeout(() => {
        t.style.transition = "opacity 0.4s";
        t.style.opacity = "0";
        setTimeout(() => t.remove(), 400);
    }, 10);
}

// Corner celebration
function celebrate() {
    flash.style.transition = "none";
    flash.style.opacity = "1";
    setTimeout(() => {
        flash.style.transition = "opacity 0.5s";
        flash.style.opacity = "0";
    }, 50);

    for (let i = 0; i < 40; i++) {
        const p = document.createElement("div");
        p.style.position = "absolute";
        p.style.width = "6px";
        p.style.height = "6px";
        p.style.background = `hsl(${Math.random()*360},100%,50%)`;
        p.style.left = dvd.offsetLeft + dvd.clientWidth/2 + "px";
        p.style.top = dvd.offsetTop + dvd.clientHeight/2 + "px";
        p.style.borderRadius = "50%";
        p.style.pointerEvents = "none";
        effects.appendChild(p);

        const angle = Math.random() * Math.PI * 2;
        const speed = 4 + Math.random() * 6;

        let vx = Math.cos(angle) * speed;
        let vy = Math.sin(angle) * speed;

        let life = 30 + Math.random()*20;

        function animateParticle() {
            p.style.left = (parseFloat(p.style.left) + vx) + "px";
            p.style.top = (parseFloat(p.style.top) + vy) + "px";
            vy += 0.2;
            life--;

            if (life > 0) requestAnimationFrame(animateParticle);
            else p.remove();
        }
        animateParticle();
    }
}

// Instant mode
function runInstant() {
    let x = dvd.offsetLeft + dvd.clientWidth / 2;
    let y = dvd.offsetTop + dvd.clientHeight / 2;
    let w = window.innerWidth - dvd.clientWidth / 2;
    let h = window.innerHeight - dvd.clientHeight / 2;

    let vx = (window.innerWidth / 2 - x) * 0.15;
    let vy = (window.innerHeight / 2 - y) * 0.15;

    let bounces = 0;

    while (true) {
        let tx = vx > 0 ? (w - x) / vx : (dvd.clientWidth / 2 - x) / vx;
        let ty = vy > 0 ? (h - y) / vy : (dvd.clientHeight / 2 - y) / vy;

        let t = Math.min(tx, ty);

        x += vx * t;
        y += vy * t;

        let hitV = Math.abs(x - dvd.clientWidth / 2) < 1 || Math.abs(x - w) < 1;
        let hitH = Math.abs(y - dvd.clientHeight / 2) < 1 || Math.abs(y - h) < 1;

        if (hitV) bounces++;
        if (hitH) bounces++;

        if (hitV && hitH) break;

        if (hitV) vx *= -1;
        if (hitH) vy *= -1;
    }

    bounceCountEl.textContent = bounces;
    celebrate();

    setTimeout(() => {
        centerDVD();
    }, 600);
}

// Animation loop
function update() {
    if (!animating) return;

    // compute velocity fresh each frame based on current speed
    vx = baseVX * speedMultiplier;
    vy = baseVY * speedMultiplier;

    spawnTrail();

    let x = dvd.offsetLeft + vx;
    let y = dvd.offsetTop + vy;

    const maxX = window.innerWidth - dvd.clientWidth;
    const maxY = window.innerHeight - dvd.clientHeight;

    let hitCorner = false;

    if (x <= 0 || x >= maxX) {
        baseVX *= -1;
        bounceCount++;
    }
    if (y <= 0 || y >= maxY) {
        baseVY *= -1;
        bounceCount++;
    }

    if ((x <= 0 || x >= maxX) && (y <= 0 || y >= maxY)) {
        hitCorner = true;
    }

    bounceCountEl.textContent = bounceCount;

    dvd.style.left = Math.max(0, Math.min(maxX, x)) + "px";
    dvd.style.top = Math.max(0, Math.min(maxY, y)) + "px";

    if (hitCorner) {
        animating = false;
        celebrate();

        setTimeout(() => {
            centerDVD();
        }, 600);

        return;
    }

    requestAnimationFrame(update);
}
</script>

</body>
</html>
